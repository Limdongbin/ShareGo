<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.java501.S20230401.ArticleMapper">
	
	<select id="shCustomerCount" resultType="int">
	 <![CDATA[
		SELECT Count(*)
		FROM article
		WHERE brd_id >=1500 and brd_id <1600
 	 ]]>	
	</select>
	
	<select id="shListCustomer" parameterType="Article" resultType="Article">
	 <![CDATA[
		SELECT *
  		FROM 
  			(
    		SELECT ROWNUM RN, A.*, M.MEM_NICKNAME, M.MEM_IMAGE, NVL(R.REP_COUNT, 0) REP_COUNT
    		FROM ARTICLE A
    		LEFT JOIN MEMBER M ON A.MEM_ID = M.MEM_ID
    		LEFT JOIN 
    			(
      			SELECT ART_ID, BRD_ID, COUNT(*) REP_COUNT
      			FROM REPLY
      			GROUP BY ART_ID, BRD_ID
    			) R
    		ON A.ART_ID = R.ART_ID AND A.BRD_ID = R.BRD_ID
    		WHERE A.BRD_ID >= 1500 AND A.BRD_ID < 1600
    		ORDER BY A.ART_ID DESC
  			)
  		WHERE RN BETWEEN #{start} AND #{end}
 	 ]]>	
	</select>
	
	<select id="shListCustomerMenu" parameterType="Article" resultType="Article">
	 <![CDATA[
		SELECT *
  		FROM 
  			(
    		SELECT ROWNUM RN, A.*, M.MEM_NICKNAME, M.MEM_IMAGE, NVL(R.REP_COUNT, 0) REP_COUNT
    		FROM ARTICLE A
    		LEFT JOIN MEMBER M ON A.MEM_ID = M.MEM_ID
    		LEFT JOIN 
    			(
      			SELECT ART_ID, BRD_ID, COUNT(*) REP_COUNT
      			FROM REPLY
      			GROUP BY ART_ID, BRD_ID
    			) R
    		ON A.ART_ID = R.ART_ID AND A.BRD_ID = R.BRD_ID
    		WHERE A.BRD_ID = #{brd_id}
    		ORDER BY A.ART_ID DESC
  			)
  		WHERE RN BETWEEN #{start} AND #{end}
 	 ]]>	
	</select>
		
	<select id="shCustomerDetail" parameterType="Article" resultType="Article">
	  <![CDATA[
        	 SELECT A.*, M.MEM_NICKNAME, M.MEM_IMAGE, NVL(R.REP_COUNT, 0) REP_COUNT
			 FROM ARTICLE A
			 LEFT JOIN MEMBER M ON A.MEM_ID = M.MEM_ID
			 LEFT JOIN (SELECT ART_ID, BRD_ID, COUNT(*) REP_COUNT
			 	 		FROM REPLY
			 	 		GROUP BY ART_ID, BRD_ID) R
			 	 		ON (A.ART_ID = R.ART_ID AND A.BRD_ID = R.BRD_ID)
			 	 		WHERE A.ART_ID = #{art_id} AND A.BRD_ID = #{brd_id}
	  ]]>
	</select>
	
	<insert id="shInsertCustomer" parameterType="Article">
		INSERT into article (art_id, brd_id, art_title, mem_id, art_content, art_regdate) 
		VALUES (#{art_id}, #{brd_id}, #{art_title}, #{mem_id}, #{art_content}, #{art_regdate})
	</insert>
	
	
	
	
	<insert id="hgInsertArticle" parameterType="Article">
		<!-- INSERT INTO ARTICLE (ART_ID, BRD_ID, ART_TITLE, MEM_ID, ART_REGDATE, ART_CONTENT,
							 ART_TAG1, ART_TAG2, ART_TAG3, ART_TAG4, ART_TAG5, TRD_ID, ART_GOOD,
							 ART_BAD, ART_READ, ART_ISNOTICE, ISDELETE, REPORT_ID)
		VALUES ((SELECT MAX(ART_ID) + 1 FROM ARTICLE WHERE BRD_ID = #{brd_id}), #{brd_id},
				#{art_title, jdbcType=VARCHAR}, #{mem_id}, SYSDATE, #{art_content, jdbcType=VARCHAR},
				#{art_tag1, jdbcType=VARCHAR}, #{art_tag2, jdbcType=VARCHAR}, #{art_tag3, jdbcType=VARCHAR},
				#{art_tag4, jdbcType=VARCHAR}, #{art_tag5, jdbcType=VARCHAR}, #{trd_id, jdbcType=NUMERIC},
				0, 0, 0, 0, 0, NULL) -->
		INSERT INTO ARTICLE (ART_ID, BRD_ID, ART_TITLE, MEM_ID, ART_REGDATE, ART_CONTENT,
							 ART_TAG1, ART_TAG2, ART_TAG3, ART_TAG4, ART_TAG5, TRD_ID, ART_GOOD,
							 ART_BAD, ART_READ, ART_ISNOTICE, ISDELETE, REPORT_ID)
		VALUES ((SELECT MAX(ART_ID) + 1 FROM ARTICLE WHERE BRD_ID = #{brd_id}), #{brd_id},
				#{art_title, jdbcType=VARCHAR}, #{mem_id}, SYSDATE, #{art_content, jdbcType=VARCHAR},
				#{art_tag1, jdbcType=VARCHAR}, #{art_tag2, jdbcType=VARCHAR}, #{art_tag3, jdbcType=VARCHAR},
				#{art_tag4, jdbcType=VARCHAR}, #{art_tag5, jdbcType=VARCHAR}, NULL,
				0, 0, 0, 0, 0, NULL)
	</insert>
	<select id="hgGetArticleById" parameterType="Article" resultType="Article">
		SELECT * FROM ARTICLE
		WHERE ART_ID = #{art_id} AND BRD_ID = #{brd_id}
	</select>
</mapper>