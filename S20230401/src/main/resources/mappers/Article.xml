<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.java501.S20230401.ArticleMapper">
	
	<select id="shArticleIndex" parameterType="Article" resultType="Article">
	 <![CDATA[
		SELECT Count(*)
		FROM article
		WHERE brd_id ={#brd_id} and brd_id < {#brd_id} + 100
 	 ]]>	
	</select>
	
	<select id="shListCustomer" parameterType="Article" resultType="Article">
	 <![CDATA[
		SELECT *
  		FROM 
  			(
    		SELECT ROWNUM RN, A.*, M.MEM_NICKNAME, M.MEM_IMAGE, NVL(R.REP_COUNT, 0) REP_COUNT
    		FROM ARTICLE A
    		LEFT JOIN MEMBER M ON A.MEM_ID = M.MEM_ID
    		LEFT JOIN 
    			(
      			SELECT ART_ID, BRD_ID, COUNT(*) REP_COUNT
      			FROM REPLY
      			GROUP BY ART_ID, BRD_ID
    			) R
    		ON A.ART_ID = R.ART_ID AND A.BRD_ID = R.BRD_ID
    		WHERE A.BRD_ID >= 1500 AND A.BRD_ID < 1600
    		ORDER BY A.ART_ID DESC
  			)
  		WHERE RN BETWEEN #{start} AND #{end}
 	 ]]>	
	</select>
		
	<select id="noticeTotal" resultType="int">
	<![CDATA[
		SELECT Count(*)
		FROM article
		WHERE brd_id >=1500 and brd_id <1511
	]]>
	</select>
	
	<select id="shCustomerDetail" parameterType="Article" resultType="Article">
	  <![CDATA[
        	 SELECT A.*, M.MEM_NICKNAME, M.MEM_IMAGE, NVL(R.REP_COUNT, 0) REP_COUNT
			 FROM ARTICLE A
			 LEFT JOIN MEMBER M ON A.MEM_ID = M.MEM_ID
			 LEFT JOIN (SELECT ART_ID, BRD_ID, COUNT(*) REP_COUNT
			 	 		FROM REPLY
			 	 		GROUP BY ART_ID, BRD_ID) R
			 	 		ON (A.ART_ID = R.ART_ID AND A.BRD_ID = R.BRD_ID)
			 	 		WHERE A.ART_ID = #{art_id} AND A.BRD_ID = #{brd_id}
	  ]]>
	</select>

    
	
</mapper>