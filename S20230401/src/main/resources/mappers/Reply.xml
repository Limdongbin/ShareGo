<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="S20230401/src/main/java/com/java501/S20230401/model/ReplyMapper">
	<select id="bjCountReply" parameterType="Reply" resultType="Reply">
		SELECT COUNT(*) AS rep_cnt
		FROM reply
		WHERE art_id = #{art_id}  AND brd_id = #{brd_id} AND isdelete = 0
	</select>
	
	<select id="bjreplyMain" parameterType="Reply" resultType="Reply">
		SELECT reply.*, member.*
		FROM reply
		INNER JOIN member ON reply.mem_id = member.mem_id
		WHERE reply.art_id = #{art_id} AND reply.brd_id = #{brd_id} AND reply.isdelete = 0
	</select>
	<insert id="bjReplyWrite" parameterType="Reply">
	INSERT INTO REPLY (
						art_id,
						brd_id,
						rep_id,
						mem_id,
						rep_content,
						rep_regdate,
						rep_good,
						rep_bad,
						rep_parent,
						rep_step,
						isdelete,
						report_id 
						)
				VALUES(
						#{art_id},
						#{brd_id},
						(SELECT NVL(MAX(rep_id), 0) + 1 FROM REPLY WHERE art_id=#{art_id} AND brd_id=#{brd_id}),
						#{mem_id},
						#{rep_content},
						SYSDATE,
						0, 0, 1, 1, 0, null )
	</insert>
	<insert id="bjReplyDelete" parameterType="Reply">
	UPDATE reply
		  SET
		  	isdelete = 1
		WHERE art_id=#{art_id} AND brd_id = #{brd_id} AND rep_id =#{rep_id}
	</insert>
</mapper>