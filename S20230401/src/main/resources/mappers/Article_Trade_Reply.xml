<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.java501.S20230401.Article_Trade_ReplyMapper">

	<select id="JHDutchpayList" parameterType="Article_Trade_Reply" resultType="Article_Trade_Reply"><!-- 진현 -->
		SELECT a.art_id, a.brd_id,
			   c.comm_value, a.art_title, a.art_regdate, 
      		   a.art_tag1, a.art_tag2, a.art_tag3, a.art_tag4, a.art_tag5,
       		   t.trd_cost, 
       		   r.reg_name, 
       		   t.trd_max, 
       		   m.mem_image,
       		   m.mem_username, 
       		   t.trd_enddate, 
       		   a.art_good, a.art_bad, a.art_read,
       		   REP_CNT(brd_id, art_id) AS reply_count
		FROM article a
		LEFT JOIN trade t ON a.trd_id = t.trd_id
		LEFT JOIN comm c ON t.trd_status = c.comm_id
		LEFT JOIN region r ON t.reg_id = r.reg_id
		LEFT JOIN member m ON a.mem_id = m.mem_id
		WHERE a.brd_id between 1100 and 1200 and a.isdelete = 0 
		<!--  ORDER BY a.art.regdate desc -->
	</select>
	
	<select id="JHDutchpayFoodList" resultType="Article_Trade_Reply">
		SELECT a.art_id, a.brd_id,
			   c.comm_value, a.art_title, a.art_regdate, 
      		   a.art_tag1, a.art_tag2, a.art_tag3, a.art_tag4, a.art_tag5,
       		   t.trd_cost, 
       		   r.reg_name, 
       		   t.trd_max, 
       		   m.mem_image,
       		   m.mem_username, 
       		   t.trd_enddate, 
       		   a.art_good, a.art_bad, a.art_read,
       		   REP_CNT(brd_id, art_id) AS reply_count
		FROM article a
		LEFT JOIN trade t ON a.trd_id = t.trd_id
		LEFT JOIN comm c ON t.trd_status = c.comm_id
		LEFT JOIN region r ON t.reg_id = r.reg_id
		LEFT JOIN member m ON a.mem_id = m.mem_id
		WHERE a.brd_id = 1110 and a.isdelete = 0 
	</select>
	
	<select id="JHDutchpayClothesList"  resultType="Article_Trade_Reply">
		SELECT a.art_id, a.brd_id,
			   c.comm_value, a.art_title, a.art_regdate, 
      		   a.art_tag1, a.art_tag2, a.art_tag3, a.art_tag4, a.art_tag5,
       		   t.trd_cost, 
       		   r.reg_name, 
       		   t.trd_max, 
       		   m.mem_image,
       		   m.mem_username, 
       		   t.trd_enddate, 
       		   a.art_good, a.art_bad, a.art_read,
       		   REP_CNT(brd_id, art_id) AS reply_count
		FROM article a
		LEFT JOIN trade t ON a.trd_id = t.trd_id
		LEFT JOIN comm c ON t.trd_status = c.comm_id
		LEFT JOIN region r ON t.reg_id = r.reg_id
		LEFT JOIN member m ON a.mem_id = m.mem_id
		WHERE a.brd_id = 1120 and a.isdelete = 0 
	</select>
	
	<select id="JHDutchpayHouseStuffList"  resultType="Article_Trade_Reply">
		SELECT a.art_id, a.brd_id,
			   c.comm_value, a.art_title, a.art_regdate, 
      		   a.art_tag1, a.art_tag2, a.art_tag3, a.art_tag4, a.art_tag5,
       		   t.trd_cost, 
       		   r.reg_name, 
       		   t.trd_max, 
       		   m.mem_image,
       		   m.mem_username, 
       		   t.trd_enddate, 
       		   a.art_good, a.art_bad, a.art_read,
       		   REP_CNT(brd_id, art_id) AS reply_count
		FROM article a
		LEFT JOIN trade t ON a.trd_id = t.trd_id
		LEFT JOIN comm c ON t.trd_status = c.comm_id
		LEFT JOIN region r ON t.reg_id = r.reg_id
		LEFT JOIN member m ON a.mem_id = m.mem_id
		WHERE a.brd_id = 1130 and a.isdelete = 0 
	</select>
	
	<select id="JHDutchpayOverseasList"  resultType="Article_Trade_Reply">
		SELECT a.art_id, a.brd_id,
			   c.comm_value, a.art_title, a.art_regdate, 
      		   a.art_tag1, a.art_tag2, a.art_tag3, a.art_tag4, a.art_tag5,
       		   t.trd_cost, 
       		   r.reg_name, 
       		   t.trd_max, 
       		   m.mem_image,
       		   m.mem_username, 
       		   t.trd_enddate, 
       		   a.art_good, a.art_bad, a.art_read,
       		   REP_CNT(brd_id, art_id) AS reply_count
		FROM article a
		LEFT JOIN trade t ON a.trd_id = t.trd_id
		LEFT JOIN comm c ON t.trd_status = c.comm_id
		LEFT JOIN region r ON t.reg_id = r.reg_id
		LEFT JOIN member m ON a.mem_id = m.mem_id
		WHERE a.brd_id = 1140 and a.isdelete = 0 
	</select>
	
	<select id="JHDutchpayEtcList"  resultType="Article_Trade_Reply">
		SELECT a.art_id, a.brd_id,
			   c.comm_value, a.art_title, a.art_regdate, 
      		   a.art_tag1, a.art_tag2, a.art_tag3, a.art_tag4, a.art_tag5,
       		   t.trd_cost, 
       		   r.reg_name, 
       		   t.trd_max, 
       		   m.mem_image,
       		   m.mem_username, 
       		   t.trd_enddate, 
       		   a.art_good, a.art_bad, a.art_read,
       		   REP_CNT(brd_id, art_id) AS reply_count
		FROM article a
		LEFT JOIN trade t ON a.trd_id = t.trd_id
		LEFT JOIN comm c ON t.trd_status = c.comm_id
		LEFT JOIN region r ON t.reg_id = r.reg_id
		LEFT JOIN member m ON a.mem_id = m.mem_id
		WHERE a.brd_id = 1150 and a.isdelete = 0 
	</select>
	
	<select id="JHDutchpayDetail" parameterType="Article_Trade_Reply" resultType="Article_Trade_Reply">
		SELECT a.art_id, a.brd_id,
			   m.mem_image, m.mem_username,
       		   c.comm_value, a.art_title, a.art_regdate, 
       		   a.art_tag1, a.art_tag2, a.art_tag3, a.art_tag4, a.art_tag5,
      		   t.trd_cost,
      		   t.trd_max,
       		   r.reg_name,
       		   t.trd_loc, 
       		   t.trd_enddate , a.art_good, a.art_bad, a.art_read,
       		   a.art_content,
               REP_CNT(brd_id, art_id) AS reply_count
		FROM article a
		LEFT JOIN trade t  ON a.trd_id = t.trd_id
		LEFT JOIN comm c   ON t.trd_status = c.comm_id
		LEFT JOIN region r ON t.reg_id = r.reg_id
		LEFT JOIN member m ON a.mem_id = m.mem_id
        WHERE a.brd_id=#{brd_id} and a.art_id=#{art_id}
	</select>
	
	<select id="JHRepList" parameterType="Article_Trade_Reply" resultType="Article_Trade_Reply">
		SELECT r.rep_id, m.mem_nickname, r.rep_content, r.rep_regdate, r.rep_parent, r.rep_step
		FROM reply r
		LEFT JOIN member m
		ON r.mem_id = m.mem_id
		WHERE brd_id=#{brd_id} and art_id=#{art_id}
		ORDER BY rep_regdate desc, rep_parent asc, rep_step asc 
	</select>
	
	<select id="JHInsert" parameterType="Article_Trade_Reply" statementType="CALLABLE">
		{
			CALL insert_form(
				#{brd_id, 			mode=IN,  jdbcType=NUMERIC},
				#{art_title, 		mode=IN,  jdbcType=VARCHAR},
				#{art_regdate, 		mode=IN,  jdbcType=DATE},
				#{art_tag1, 		mode=IN,  jdbcType=VARCHAR},
				#{art_tag2, 		mode=IN,  jdbcType=VARCHAR},
				#{art_tag3, 		mode=IN,  jdbcType=VARCHAR},
				#{art_tag4, 		mode=IN,  jdbcType=VARCHAR},
				#{art_tag5, 		mode=IN,  jdbcType=VARCHAR},
				#{art_content, 		mode=IN,  jdbcType=CLOB},
				#{isdelete, 		mode=IN,  jdbcType=NUMERIC},
				#{trd_status, 		mode=IN,  jdbcType=NUMERIC},
				#{trd_enddate, 		mode=IN,  jdbcType=DATE},
				#{trd_max, 			mode=IN,  jdbcType=NUMERIC},
				#{trd_cost, 		mode=IN,  jdbcType=NUMERIC},
				#{trd_loc, 			mode=IN,  jdbcType=VARCHAR},
				#{reg_id, 			mode=IN,  jdbcType=NUMERIC}
			)
		}
	</select>
	
	<select id="JHUpdateForm" parameterType="Article_Trade_Reply" resultType="Article_Trade_Reply">
		SELECT a.art_id, a.brd_id,
			   m.mem_image, m.mem_username,
			   a.art_regdate,
			   a.art_title,
       		   a.art_tag1, a.art_tag2, a.art_tag3, a.art_tag4, a.art_tag5,
      		   t.trd_cost,
      		   t.trd_max,
      		   t.trd_loc,
      		   r.reg_id,
       		   a.art_content
		FROM article a
		LEFT JOIN trade t  ON a.trd_id = t.trd_id
		LEFT JOIN region r ON t.reg_id = r.reg_id
		LEFT JOIN member m ON a.mem_id = m.mem_id
		WHERE a.brd_id=#{brd_id} and a.art_id=#{art_id}

	</select>
	
	<select id="JHUpdate" parameterType="Article_Trade_Reply" statementType="CALLABLE">
		 {
			CALL update_form(
				#{art_id, 			mode=IN,  jdbcType=NUMERIC},
				#{brd_id, 			mode=IN,  jdbcType=NUMERIC},
				#{art_title, 		mode=IN,  jdbcType=VARCHAR},
				#{art_tag1, 		mode=IN,  jdbcType=VARCHAR},
				#{art_tag2, 		mode=IN,  jdbcType=VARCHAR},
				#{art_tag3, 		mode=IN,  jdbcType=VARCHAR},
				#{art_tag4, 		mode=IN,  jdbcType=VARCHAR},
				#{art_tag5, 		mode=IN,  jdbcType=VARCHAR},
				#{art_content, 		mode=IN,  jdbcType=CLOB},
				#{trd_enddate, 		mode=IN,  jdbcType=DATE},
				#{trd_cost, 		mode=IN,  jdbcType=NUMERIC},
				#{trd_max, 			mode=IN,  jdbcType=NUMERIC},
				#{reg_id, 			mode=IN,  jdbcType=NUMERIC},
				#{trd_loc, 			mode=IN,  jdbcType=VARCHAR}
			)
		}
	</select>
	
	<select id="JHDelete" parameterType="Article_Trade_Reply" resultType="Article_Trade_Reply">
		UPDATE article SET isdelete = 1 WHERE brd_id = #{brd_id} and art_id = #{art_id}
	</select>
	
	<update id="JHDeatilRead" parameterType="Article_Trade_Reply" >
		UPDATE article SET art_read = art_read+1 WHERE brd_id=#{brd_id} and art_id=#{art_id}
	</update>

	<!-- <select id="JHPaging" parameterType="Article_Trade_Reply" resultType="Article_Trade_Reply">
		SELECT *
		FROM 
			(
			SELECT rownum rn, a.*
			FROM 
				(SELECT *
				 FROM article
				 WHERE
			<choose>
				<when test="brd_id == 1100">
					brd_id between 1100 and 1200
				</when>
				<otherwise>
					brd_id = #{brd_id}
				</otherwise>
			</choose>
				and isdelete = 0
				ORDER BY art_id) a
			)
		WHERE rn between #{start} and #{end}
			
	</select> -->


</mapper>

