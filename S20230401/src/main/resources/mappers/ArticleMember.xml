<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.java501.S20230401.ArticleMemberMapper">

	<!-- 유현규 -->
	<select id="hgGetSummaryRECENT" parameterType="int" resultType="ArticleMember">
		<![CDATA[
			SELECT * FROM (
				SELECT A.ART_ID, A.BRD_ID, A.ART_TITLE, A.ART_REGDATE, A.TRD_ID, A.ART_GOOD, A.ART_BAD, A.ART_READ, M.MEM_NICKNAME, M.MEM_IMAGE
				FROM ARTICLE A JOIN MEMBER M USING(MEM_ID)
				WHERE TRUNC(BRD_ID / 100) * 100 = #{boardNum}
					  AND A.ISDELETE = 0
					  AND ART_ISNOTICE = 0
				ORDER BY ART_REGDATE DESC)
			WHERE ROWNUM <= 5
		]]>
	</select>
	<select id="hgGetSummaryPOPULAR" parameterType="int" resultType="ArticleMember">
		<![CDATA[
			SELECT * FROM (
				SELECT A.ART_ID, A.BRD_ID, A.ART_TITLE, A.ART_REGDATE, A.TRD_ID, A.ART_GOOD, A.ART_BAD, A.ART_READ, M.MEM_NICKNAME, M.MEM_IMAGE
				FROM ARTICLE A JOIN MEMBER M USING(MEM_ID)
				WHERE TRUNC(BRD_ID / 100) * 100 = #{boardNum}
					  AND A.ISDELETE = 0
					  AND ART_ISNOTICE = 0
					  AND ART_REGDATE > SYSDATE - 7
				ORDER BY A.ART_GOOD DESC)
			WHERE ROWNUM <= 5
		]]>
	</select>
	<select id="hgCalculateGood" parameterType="ArticleMember" resultType="int">
		SELECT COUNT(*) FROM HISTORY
		WHERE TRD_ID IN (SELECT TRD_ID FROM TRADE WHERE MEM_ID = #{mem_id})
				  AND HIS_SCORE = 1
	</select>
	<select id="hgCalculateNormal" parameterType="ArticleMember" resultType="int">
		SELECT COUNT(*) FROM HISTORY
		WHERE TRD_ID IN (SELECT TRD_ID FROM TRADE WHERE MEM_ID = #{mem_id})
				  AND HIS_SCORE = 0
	</select>
	<select id="hgCalculateBad" parameterType="ArticleMember" resultType="int">
		SELECT COUNT(*) FROM HISTORY
		WHERE TRD_ID IN (SELECT TRD_ID FROM TRADE WHERE MEM_ID = #{mem_id})
				  AND HIS_SCORE = -1
	</select>
	<select id="hgCalculateEnddate" parameterType="ArticleMember" resultType="java.util.Date">
		SELECT TRD_ENDDATE FROM TRADE
		WHERE TRD_ID = #{trd_id}
	</select>
	<select id="hgCountReply" parameterType="ArticleMember" resultType="int">
		SELECT COUNT(*) FROM REPLY
		WHERE ART_ID = #{art_id} AND BRD_ID = #{brd_id}
	</select>
</mapper>